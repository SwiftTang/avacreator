<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„åˆ›æ„ - åˆ›æ„ä¸­å¿ƒ</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="../css/ideas.css">
    <style>
        .my-ideas-container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .idea-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.8) 0%, rgba(114, 9, 183, 0.3) 100%);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(0, 245, 255, 0.2);
            border-radius: 15px;
            overflow: hidden;
        }
        
        .idea-table th,
        .idea-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(0, 245, 255, 0.2);
        }
        
        .idea-table th {
            background: rgba(0, 0, 0, 0.3);
            color: #00f5ff;
            font-weight: 600;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .idea-table tr:last-child td {
            border-bottom: none;
        }
        
        .idea-table tr:hover {
            background: rgba(0, 245, 255, 0.1);
        }
        
        .idea-table .idea-title {
            font-weight: 600;
            color: #e8f4f8;
        }
        
        .idea-table .idea-title a {
            color: #00f5ff;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .idea-table .idea-title a:hover {
            text-decoration: underline;
            opacity: 0.8;
        }
        
        .idea-table .idea-date {
            color: rgba(232, 244, 248, 0.7);
            font-size: 0.9em;
        }
        
        .idea-table .idea-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }
        
        .idea-table .idea-points {
            font-weight: 600;
            color: #a8e6cf;
        }
        
        .idea-table .idea-actions {
            display: flex;
            gap: 8px;
        }
        
        .idea-table .action-btn {
            padding: 5px 10px;
            font-size: 0.8em;
        }
        
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.8) 0%, rgba(114, 9, 183, 0.3) 100%);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(0, 245, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #00f5ff;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: rgba(232, 244, 248, 0.7);
            font-size: 0.9em;
        }
        
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-select {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(0, 245, 255, 0.3);
            border-radius: 8px;
            color: white;
            font-size: 0.9em;
            min-width: 150px;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: #00f5ff;
        }
        
        @media (max-width: 768px) {
            .idea-table {
                display: block;
                overflow-x: auto;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ä¾§è¾¹æ  -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">AIåˆ›ä½œå¹³å°</div>
            </div>
            <div class="sidebar-menu">
                <a href="dashboard.html" class="menu-item">
                    <span class="menu-icon">ğŸ“Š</span>
                    <span class="menu-text">ä»ªè¡¨ç›˜</span>
                </a>
                <a href="projects.html" class="menu-item">
                    <span class="menu-icon">ğŸ“</span>
                    <span class="menu-text">é¡¹ç›®ç®¡ç†</span>
                </a>
                <a href="ideas.html" class="menu-item active">
                    <span class="menu-icon">ğŸ’¡</span>
                    <span class="menu-text">åˆ›æ„ä¸­å¿ƒ</span>
                </a>
                <!-- å…¶ä»–èœå•é¡¹ -->
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-container">
            <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
            <div class="top-bar">
                <div class="page-title">æˆ‘çš„åˆ›æ„</div>
                <div class="user-info">
                    <span id="userRole" class="user-role">ç”¨æˆ·</span>
                    <span id="currentUsername" class="username">ç”¨æˆ·å</span>
                    <div class="avatar">ğŸ‘¤</div>
                </div>
            </div>

            <!-- ä¸»è¦å†…å®¹ -->
            <div class="main-content">
                <div class="content-header">
                    <div class="header-content">
                        <div>
                            <h1 class="content-title">æˆ‘çš„åˆ›æ„</h1>
                            <p class="content-subtitle">ç®¡ç†æ‚¨æäº¤çš„æ‰€æœ‰åˆ›æ„</p>
                        </div>
                        <div class="header-actions">
                            <button class="action-btn" onclick="window.location.href='idea-submit.html'">
                                <span>â•</span>æäº¤åˆ›æ„
                            </button>
                            <button class="action-btn secondary" onclick="window.location.href='ideas.html'">
                                <span>â†</span>è¿”å›åˆ›æ„ä¸­å¿ƒ
                            </button>
                        </div>
                    </div>
                </div>

                <div class="content-body">
                    <div class="my-ideas-container">
                        <!-- ç»Ÿè®¡å¡ç‰‡ -->
                        <div class="stats-cards">
                            <div class="stat-card">
                                <div class="stat-value" id="totalIdeas">0</div>
                                <div class="stat-label">åˆ›æ„æ€»æ•°</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="approvedIdeas">0</div>
                                <div class="stat-label">å·²é‡‡çº³åˆ›æ„</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="totalPoints">0</div>
                                <div class="stat-label">è·å¾—ç§¯åˆ†</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="totalVotes">0</div>
                                <div class="stat-label">è·å¾—å¥½è¯„</div>
                            </div>
                        </div>
                        
                        <!-- ç­›é€‰å™¨ -->
                        <div class="filters">
                            <select id="statusFilter" class="filter-select" onchange="filterIdeas()">
                                <option value="all">æ‰€æœ‰çŠ¶æ€</option>
                                <option value="pending">å¾…å®¡æ ¸</option>
                                <option value="approved">å·²é‡‡çº³</option>
                                <option value="rejected">æœªé‡‡çº³</option>
                            </select>
                            
                            <select id="sortFilter" class="filter-select" onchange="filterIdeas()">
                                <option value="date-desc">æœ€æ–°æäº¤</option>
                                <option value="date-asc">æœ€æ—©æäº¤</option>
                                <option value="votes-desc">å¥½è¯„æœ€å¤š</option>
                                <option value="points-desc">ç§¯åˆ†æœ€é«˜</option>
                            </select>
                        </div>
                        
                        <!-- åˆ›æ„è¡¨æ ¼ -->
                        <table class="idea-table">
                            <thead>
                                <tr>
                                    <th>åˆ›æ„æ ‡é¢˜</th>
                                    <th>æäº¤æ—¶é—´</th>
                                    <th>çŠ¶æ€</th>
                                    <th>å¥½è¯„æ•°</th>
                                    <th>è·å¾—ç§¯åˆ†</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="ideasTableBody">
                                <!-- åˆ›æ„åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </tbody>
                        </table>
                        
                        <!-- ç©ºçŠ¶æ€ -->
                        <div id="emptyState" class="empty-ideas" style="display: none;">
                            <div class="icon">ğŸ’¡</div>
                            <h3>æš‚æ— åˆ›æ„</h3>
                            <p>æ‚¨è¿˜æ²¡æœ‰æäº¤è¿‡åˆ›æ„ï¼Œç«‹å³æäº¤ä¸€ä¸ªæ–°åˆ›æ„å¼€å§‹å§ï¼</p>
                            <button class="action-btn" onclick="window.location.href='idea-submit.html'">æäº¤åˆ›æ„</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥å®¹å™¨ -->
    <div id="notificationContainer" class="notification-container"></div>

    <script src="../js/common.js"></script>
    <script>
        // é¡µé¢çŠ¶æ€ç®¡ç†
        const State = {
            user: null,
            ideas: [],
            filteredIdeas: [],
            filters: {
                status: 'all',
                sort: 'date-desc'
            }
        };

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initPage();
        });

        // åˆå§‹åŒ–é¡µé¢
        async function initPage() {
            try {
                // æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
                State.user = getCurrentUser();
                if (!State.user) {
                    window.location.href = '/';
                    return;
                }
                
                // æ›´æ–°ç”¨æˆ·ç•Œé¢
                updateUserInterface();
                
                // åŠ è½½æˆ‘çš„åˆ›æ„æ•°æ®
                await loadMyIdeas();
                
            } catch (error) {
                console.error('é¡µé¢åˆå§‹åŒ–å¤±è´¥:', error);
                showNotification('é¡µé¢åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•', 'error');
            }
        }

        // è·å–å½“å‰ç”¨æˆ·
        function getCurrentUser() {
            const userData = localStorage.getItem('userData') || localStorage.getItem('avaCreatorUser');
            return userData ? JSON.parse(userData) : null;
        }

        // æ›´æ–°ç”¨æˆ·ç•Œé¢
        function updateUserInterface() {
            const user = State.user;
            if (!user) return;

            // æ›´æ–°ç”¨æˆ·åæ˜¾ç¤º
            const usernameEl = document.getElementById('currentUsername');
            if (usernameEl) {
                usernameEl.textContent = user.username || user.nickname || 'ç”¨æˆ·';
            }

            // æ›´æ–°è§’è‰²æ˜¾ç¤º
            const roleEl = document.getElementById('userRole');
            if (roleEl) {
                const roleNames = {
                    'admin': 'ç®¡ç†å‘˜',
                    'investor': 'æŠ•èµ„è€…',
                    'product_manager': 'äº§å“ç»ç†',
                    'designer': 'è®¾è®¡å¸ˆ',
                    'developer': 'å¼€å‘è€…'
                };
                roleEl.textContent = roleNames[user.role] || 'ç”¨æˆ·';
            }
        }

        // åŠ è½½æˆ‘çš„åˆ›æ„æ•°æ®
        async function loadMyIdeas() {
            try {
                // æ¨¡æ‹ŸAPIè¯·æ±‚å»¶è¿Ÿ
                await new Promise(resolve => setTimeout(resolve, 800));
                
                // æ¨¡æ‹Ÿè·å–æˆ‘çš„åˆ›æ„æ•°æ®
                const myIdeas = getMockMyIdeas();
                
                State.ideas = myIdeas;
                
                // åº”ç”¨ç­›é€‰
                filterIdeas();
                
                // æ›´æ–°ç»Ÿè®¡æ•°æ®
                updateStats();
                
            } catch (error) {
                console.error('åŠ è½½åˆ›æ„æ•°æ®å¤±è´¥:', error);
                showNotification('åŠ è½½åˆ›æ„æ•°æ®å¤±è´¥', 'error');
            }
        }

        // è·å–æ¨¡æ‹Ÿæˆ‘çš„åˆ›æ„æ•°æ®
        function getMockMyIdeas() {
            // è¿™é‡Œåº”è¯¥æ˜¯ä»APIè·å–æ•°æ®ï¼Œç°åœ¨ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
            return [
                {
                    id: '1',
                    title: 'æ™ºèƒ½åˆ›æ„æ¨èç³»ç»Ÿ',
                    description: 'åŸºäºç”¨æˆ·å†å²è¡Œä¸ºå’Œåå¥½ï¼Œä½¿ç”¨AIç®—æ³•æ¨èä¸ªæ€§åŒ–åˆ›æ„å†…å®¹ï¼Œæé«˜ç”¨æˆ·å‚ä¸åº¦å’Œåˆ›æ„è´¨é‡ã€‚',
                    category: 'technology',
                    status: 'approved',
                    createdAt: '2024-02-15',
                    votes: 24,
                    points: 30,
                    reviewFeedback: 'è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰ä»·å€¼çš„åˆ›æ„ï¼Œå¯ä»¥æ˜¾è‘—æå‡å¹³å°ç”¨æˆ·ä½“éªŒã€‚'
                },
                {
                    id: '2',
                    title: 'åˆ›æ„åä½œç™½æ¿',
                    description: 'å®æ—¶å¤šäººåä½œçš„åœ¨çº¿ç™½æ¿å·¥å…·ï¼Œæ”¯æŒç»˜å›¾ã€æ€ç»´å¯¼å›¾ã€ä¾¿ç­¾ç­‰åŠŸèƒ½ï¼Œå¸®åŠ©å›¢é˜Ÿæ›´å¥½åœ°è¿›è¡Œåˆ›æ„å¤´è„‘é£æš´ã€‚',
                    category: 'product',
                    status: 'pending',
                    createdAt: '2024-02-20',
                    votes: 15,
                    points: 0
                },
                {
                    id: '3',
                    title: 'åˆ›æ„å±•ç¤º3Dç”»å»Š',
                    description: 'ä½¿ç”¨WebGLæŠ€æœ¯æ‰“é€ 3Dè™šæ‹Ÿç”»å»Šï¼Œä»¥æ²‰æµ¸å¼ä½“éªŒå±•ç¤ºä¼˜ç§€åˆ›æ„ä½œå“ï¼Œæä¾›æ›´æœ‰å¸å¼•åŠ›çš„åˆ›æ„æµè§ˆæ–¹å¼ã€‚',
                    category: 'ux',
                    status: 'rejected',
                    createdAt: '2024-02-05',
                    votes: 8,
                    points: 0,
                    reviewFeedback: 'æŠ€æœ¯å®ç°éš¾åº¦è¾ƒå¤§ï¼Œå½“å‰é˜¶æ®µä¸é€‚åˆæŠ•å…¥å¼€å‘èµ„æºã€‚'
                }
            ];
        }

        // ç­›é€‰åˆ›æ„
        function filterIdeas() {
            const statusFilter = document.getElementById('statusFilter').value;
            const sortFilter = document.getElementById('sortFilter').value;
            
            State.filters = {
                status: statusFilter,
                sort: sortFilter
            };
            
            // åº”ç”¨çŠ¶æ€ç­›é€‰
            State.filteredIdeas = State.ideas.filter(idea => {
                if (statusFilter === 'all') return true;
                return idea.status === statusFilter;
            });
            
            // åº”ç”¨æ’åº
            State.filteredIdeas.sort((a, b) => {
                switch (sortFilter) {
                    case 'date-desc':
                        return new Date(b.createdAt) - new Date(a.createdAt);
                    case 'date-asc':
                        return new Date(a.createdAt) - new Date(b.createdAt);
                    case 'votes-desc':
                        return b.votes - a.votes;
                    case 'points-desc':
                        return b.points - a.points;
                    default:
                        return new Date(b.createdAt) - new Date(a.createdAt);
                }
            });
            
            // æ¸²æŸ“åˆ›æ„åˆ—è¡¨
            renderIdeasTable();
        }

        // æ¸²æŸ“åˆ›æ„è¡¨æ ¼
        function renderIdeasTable() {
            const tableBody = document.getElementById('ideasTableBody');
            const emptyState = document.getElementById('emptyState');
            
            if (!tableBody || !emptyState) return;
            
            if (State.filteredIdeas.length === 0) {
                tableBody.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            const ideasHTML = State.filteredIdeas.map(idea => `
                <tr>
                    <td class="idea-title">
                        <a href="idea-detail.html?id=${idea.id}">${idea.title}</a>
                    </td>
                    <td class="idea-date">${formatDate(idea.createdAt)}</td>
                    <td>
                        <span class="idea-status status-${idea.status}">${getStatusName(idea.status)}</span>
                    </td>
                    <td>${idea.votes}</td>
                    <td class="idea-points">${idea.points}</td>
                    <td class="idea-actions">
                        <button class="idea-btn secondary action-btn" onclick="viewIdea('${idea.id}')">æŸ¥çœ‹</button>
                        ${idea.status === 'pending' ? 
                            `<button class="idea-btn secondary action-btn" onclick="editIdea('${idea.id}')">ç¼–è¾‘</button>` : ''}
                    </td>
                </tr>
            `).join('');
            
            tableBody.innerHTML = ideasHTML;
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats() {
            document.getElementById('totalIdeas').textContent = State.ideas.length;
            
            const approvedIdeas = State.ideas.filter(idea => idea.status === 'approved').length;
            document.getElementById('approvedIdeas').textContent = approvedIdeas;
            
            const totalPoints = State.ideas.reduce((sum, idea) => sum + (idea.points || 0), 0);
            document.getElementById('totalPoints').textContent = totalPoints;
            
            const totalVotes = State.ideas.reduce((sum, idea) => sum + (idea.votes || 0), 0);
            document.getElementById('totalVotes').textContent = totalVotes;
        }

        // æŸ¥çœ‹åˆ›æ„è¯¦æƒ…
        function viewIdea(ideaId) {
            window.location.href = `idea-detail.html?id=${ideaId}`;
        }

        // ç¼–è¾‘åˆ›æ„
        function editIdea(ideaId) {
            const idea = State.ideas.find(item => item.id === ideaId);
            if (!idea) {
                showNotification('åˆ›æ„ä¸å­˜åœ¨', 'error');
                return;
            }
            
            // å¦‚æœåˆ›æ„å·²ç»è¢«å®¡æ ¸ï¼Œä¸å…è®¸ç¼–è¾‘
            if (idea.status !== 'pending') {
                showNotification('å·²å®¡æ ¸çš„åˆ›æ„ä¸èƒ½ç¼–è¾‘', 'error');
                return;
            }
            
            // è·³è½¬åˆ°ç¼–è¾‘é¡µé¢
            window.location.href = `idea-edit.html?id=${ideaId}`;
        }

        // è·å–çŠ¶æ€åç§°
        function getStatusName(status) {
            const statusNames = {
                'pending': 'å¾…å®¡æ ¸',
                'approved': 'å·²é‡‡çº³',
                'rejected': 'æœªé‡‡çº³'
            };
            return statusNames[status] || 'æœªçŸ¥çŠ¶æ€';
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <span class="notification-icon">${getNotificationIcon(type)}</span>
                    <span class="notification-message">${message}</span>
                </div>
                <button class="notification-close" onclick="this.parentElement.remove()">Ã—</button>
            `;
            
            // æ·»åŠ åˆ°é¡µé¢
            const container = document.getElementById('notificationContainer');
            container.appendChild(notification);
            
            // è‡ªåŠ¨å…³é—­
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.classList.add('fade-out');
                    setTimeout(() => notification.remove(), 500);
                }
            }, 5000);
        }

        // è·å–é€šçŸ¥å›¾æ ‡
        function getNotificationIcon(type) {
            const icons = {
                'success': 'âœ…',
                'error': 'âŒ',
                'info': 'â„¹ï¸'
            };
            return icons[type] || 'â„¹ï¸';
        }
    </script>
</body>
</html>