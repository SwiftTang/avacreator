# 微信登录配置指南

## 📋 申请微信开放平台账号所需条件

### 1. 注册微信开放平台
- **官网**: https://open.weixin.qq.com/
- **账号类型**: 
  - 个人开发者（免费，功能有限）
  - 企业开发者（300元/年认证费）

### 2. 企业认证所需材料
- **营业执照**: 扫描件或照片
- **组织机构代码证**: （三证合一可不提供）
- **法人身份证**: 正反面扫描件
- **对公银行账户**: 用于小额打款验证
- **联系人信息**: 姓名、手机、邮箱

### 3. 个人开发者所需材料
- **身份证**: 正反面扫描件
- **手机号**: 用于接收验证码
- **邮箱**: 用于接收通知
- **银行卡**: 用于收款（可选）

## 🔧 创建网站应用步骤

### 1. 登录微信开放平台
- 完成开发者资质认证
- 进入"管理中心"

### 2. 创建网站应用
```
应用名称: AVACreator极速协同创新平台
应用简介: 全球领先的协同创新生态平台，支持创意者、设计师、开发者等多角色协同创作
应用官网: https://你的域名.com
应用图标: 上传120x120像素的PNG图标
```

### 3. 配置授权回调域
```
开发环境: http://localhost:3002/api/wechat/callback
测试环境: https://test.你的域名.com/api/wechat/callback  
生产环境: https://你的域名.com/api/wechat/callback
```

### 4. 获取应用凭证
提交审核通过后，可获得：
- **AppID**: wx1234567890abcdef（示例）
- **AppSecret**: 1234567890abcdef1234567890abcdef（示例）

## 🌐 域名和服务器要求

### 1. 域名要求
- **备案域名**: 必须在工信部备案
- **HTTPS证书**: 生产环境必须使用SSL证书
- **域名解析**: 正确解析到服务器IP

### 2. 推荐域名服务商
- **腾讯云**: 与CloudBase集成度高
- **阿里云**: 价格便宜，服务稳定
- **Cloudflare**: 免费SSL证书

### 3. 备案流程（约15-20个工作日）
1. 购买域名和服务器
2. 在服务商处提交备案申请
3. 上传相关证件材料
4. 等待初审（1-3个工作日）
5. 管局审核（10-15个工作日）
6. 备案完成，获得备案号

## ⚙️ 环境变量配置

### 1. 创建.env文件
```bash
# 微信开放平台配置
WECHAT_APP_ID=你的AppID
WECHAT_APP_SECRET=你的AppSecret
WECHAT_REDIRECT_URI=https://你的域名.com/api/wechat/callback

# JWT密钥
JWT_SECRET=avacreator-jwt-secret-key-2025

# 腾讯云配置
TENCENT_SECRET_ID=你的SecretId
TENCENT_SECRET_KEY=你的SecretKey
TCB_ENV_ID=你的环境ID
```

### 2. 腾讯云环境变量配置
在腾讯云CloudBase控制台 → 环境 → 环境变量中添加：
```
WECHAT_APP_ID = 你的AppID
WECHAT_APP_SECRET = 你的AppSecret  
WECHAT_REDIRECT_URI = https://你的域名.com/api/wechat/callback
JWT_SECRET = avacreator-jwt-secret-key-2025
```

## 🔐 安全配置建议

### 1. AppSecret保护
- 不要在前端代码中暴露AppSecret
- 使用环境变量存储敏感信息
- 定期更换AppSecret

### 2. 回调域名验证
- 严格限制授权回调域名
- 使用HTTPS协议
- 验证state参数防止CSRF攻击

### 3. 用户数据保护
- 遵循《个人信息保护法》
- 明确告知用户数据使用目的
- 提供用户数据删除功能

## 📱 测试流程

### 1. 开发环境测试
```bash
# 启动本地服务
npm run dev

# 访问微信登录
http://localhost:3002/api/wechat/login
```

### 2. 生产环境测试
```bash
# 部署到腾讯云
npm run deploy

# 访问线上微信登录
https://你的域名.com/api/wechat/login
```

## 💰 费用预算

### 1. 必需费用
- **微信开放平台认证**: 300元/年（企业）
- **域名注册**: 50-100元/年
- **SSL证书**: 0-500元/年（Let's Encrypt免费）
- **服务器**: 腾讯云CloudBase按量计费

### 2. 可选费用
- **企业邮箱**: 200-500元/年
- **短信服务**: 按条计费
- **CDN加速**: 按流量计费

## 🚀 快速开始

### 1. 如果你已有企业资质
1. 注册微信开放平台账号
2. 提交企业认证（1-3个工作日）
3. 创建网站应用
4. 配置回调域名
5. 获取AppID和AppSecret
6. 更新环境变量
7. 部署测试

### 2. 如果你是个人开发者
1. 先注册个人微信开放平台账号
2. 创建测试应用（功能受限）
3. 后续可升级为企业账号

### 3. 临时解决方案
如果暂时无法完成微信认证，可以：
1. 使用微信测试号（功能受限）
2. 集成其他登录方式（QQ、微博等）
3. 使用手机号+验证码登录

## 📞 技术支持

- **微信开放平台客服**: https://developers.weixin.qq.com/
- **腾讯云技术支持**: https://cloud.tencent.com/
- **项目技术支持**: 在GitHub Issues中提问

---

**注意**: 微信登录功能需要通过微信官方审核，整个流程可能需要1-2周时间。建议先准备好所有材料，然后一次性提交申请。